import{j as s}from"./jsx-runtime-BTJTZTIL.js";import{c as U}from"./index-DUmpqB7p.js";import{r as p}from"./index-CJ_LmFaV.js";import{u as F}from"./index-JZGyZbA2.js";import{h as Z,C as w}from"./ChipChoiceRow-Cf1_TVj-.js";import{i as B}from"./isBrowser-C2N6XvuH.js";import{u as k}from"./PopoverPrivate-CnKgsFAm.js";import{u as O}from"./useIsomorphicLayoutEffect-BAXQmlEq.js";import{M as Q,F as R}from"./index-B2h5DBoi.js";import{C as ee}from"./Checkbox-BQzQ2Bti.js";import{T as N}from"./Tooltip-DzAF_V2U.js";import{B as E}from"./ButtonFunction-CawjluWV.js";import{D as G}from"./DropList-o7olARL3.js";import{U as te}from"./index-DbF-M2Rm.js";import{u as ue}from"./LocaleProvider-DhC1J63f.js";import{T as ne}from"./Tag-BEBGOq3Q.js";import{e as re}from"./componentPropsProcessors-UJEZy8aQ.js";import{f as oe}from"./hooks-BS5Rmxwd.js";function ae({parentContainerRef:e,resizingContainerRef:t=e,items:n,maxVisibleItems:u=1/0}){const r=m=>Math.min(u,m),[o,l]=p.useState(r(n.length)),[f,i]=p.useState(1/0),c=p.useRef(f),a=m=>{l(typeof m=="number"?r(m):h=>m(r(h)))},d=k(()=>{const m=e.current;m&&m.scrollWidth-m.offsetWidth>0&&n[o-1]&&a(A=>A-1)}),b=k(()=>{n[o]&&a(h=>h+1)}),g=k(({changedWidth:m,initialWidth:h})=>{m>h?o<u&&b():m<h&&d()});return p.useEffect(()=>{const m=()=>{d(),e.current&&i(e.current.scrollWidth)};return document.fonts.addEventListener("loadingdone",m),()=>document.fonts.removeEventListener("loadingdone",m)},[e,d]),p.useEffect(()=>{const m=t.current;if(m){const h=new ResizeObserver(A=>A.forEach(q=>{if(q.target===m){const[{inlineSize:X}]=q.contentBoxSize;i(Math.floor(X))}}));return h.observe(m),()=>h.disconnect()}},[t]),O(()=>{e.current&&g({initialWidth:e.current.scrollWidth,changedWidth:c.current})},[n,e,g]),O(()=>{g({initialWidth:c.current,changedWidth:f}),c.current=f},[f,g]),O(()=>{d()},[d,o]),{visibleItems:n.slice(0,o),hiddenItems:n.slice(o)}}class H{constructor(t,n,u,r){this.filterKey=t,this.validate=n,this.parser=JSON.parse,this.serializer=JSON.stringify,this.getData=()=>{try{const o=this.getFromSource(),l=o?this.parser(o):null;return l&&this.validate(l)?l:null}catch{return null}},this.setData=o=>{const l=this.serializer(o);this.setToSource(l)},u&&(this.parser=u),r&&(this.serializer=r)}}class ie extends H{getFromSource(){return B()&&new URL(window.location.href).searchParams.get(this.filterKey)||""}setToSource(t){if(B()){const n=new URL(window.location.href);n.searchParams.set(this.filterKey,t),history.replaceState({},"",n)}}}class se extends H{getFromSource(){return B()&&localStorage.getItem(this.filterKey)||""}setToSource(t){B()&&localStorage.setItem(this.filterKey,t)}}const I=({source:e})=>{const t=p.useCallback(u=>{e&&e.setData(u)},[e]);return{getData:p.useCallback(()=>e==null?void 0:e.getData(),[e]),setData:t}},ce=({options:e,parser:t,serializer:n})=>{const u=p.useMemo(()=>e?new ie(e.queryKey,e.validateData,t,n):void 0,[e,t,n]),r=p.useMemo(()=>e?new se(e.localStorageKey,e.validateData):void 0,[e]),{getData:o,setData:l}=I({source:u}),{getData:f,setData:i}=I({source:r}),c=p.useCallback(d=>{l(d),i(d)},[l,i]);return{getDefaultData:p.useCallback(()=>{const d=f();return d||o()},[o,f]),setDataToStorages:c}},y={checkbox:"toolbar__checkbox",confirmAction:"toolbar__confirm-action",rejectAction:"toolbar__reject-action",deleteAction:"toolbar__delete-action",deactivateAction:"toolbar__deactivate-action",disabledAction:"toolbar__disabled-action",bulkActions:"toolbar__bulk-actions",moreBulkActionsButton:"toolbar__more-bulk-actions-button",refreshButton:"toolbar__refresh-button",search:"toolbar__search",filterButton:"toolbar__filter-button",filterRow:"toolbar__filter-row",moreActionsButton:"toolbar__more-actions-button",droplist:"toolbar__droplist",option:"toolbar__droplist-option",after:"toolbar__after"},M={Multiple:"multiple"},le="_bulkActionsWrapper_18xkl_1",de="_bulkActions_18xkl_1",fe="_checkboxWrapper_18xkl_20",me="_moreActionButton_18xkl_39",pe="_action_18xkl_43",D={bulkActionsWrapper:le,bulkActions:de,checkboxWrapper:fe,moreActionButton:me,action:pe};function v({actions:e=[],checked:t,onCheck:n,indeterminate:u,selectionMode:r=M.Multiple,resizingContainerRef:o}){const l=p.useCallback(a=>{(a.key===" "||a.key==="Enter")&&(n==null||n())},[n]),f=p.useRef(null),{visibleItems:i,hiddenItems:c}=ae({items:e,resizingContainerRef:o,parentContainerRef:f,maxVisibleItems:3});return s.jsxs(s.Fragment,{children:[r===M.Multiple&&s.jsx("div",{className:D.checkboxWrapper,onClick:n,tabIndex:0,role:"checkbox","aria-checked":t,onKeyDown:l,"data-test-id":y.checkbox,children:s.jsx(ee,{size:"s",checked:t,indeterminate:u,tabIndex:-1})}),(t||u)&&e.length>0&&s.jsxs("div",{className:D.bulkActionsWrapper,"data-test-id":y.bulkActions,ref:f,children:[s.jsx("div",{className:D.bulkActions,children:i.map(({label:a,icon:d,onClick:b,disabled:g,tooltip:m,"data-test-id":h})=>s.jsx(N,{tip:m,open:m?void 0:!1,placement:"top","data-test-id":`${h}-tooltip`,children:s.jsx(E,{className:D.action,fullWidth:!0,"data-test-id":h,iconPosition:"before",icon:s.jsx(d,{}),label:a,size:"m",onClick:b,disabled:g})},a))}),c.length>0&&s.jsx(G,{trigger:"clickAndFocusVisible",closeDroplistOnItemClick:!0,items:c.map(({label:a,icon:d,onClick:b,disabled:g,tooltip:m,"data-test-id":h})=>({id:a,content:{option:a},beforeContent:s.jsx(d,{}),onClick:b,disabled:g,itemWrapRender:A=>s.jsx(N,{tip:m,open:m?void 0:!1,placement:"right","data-test-id":`${h}-tooltip`,children:A}),"data-test-id":h})),children:s.jsx(E,{className:D.moreActionButton,size:"m",icon:s.jsx(Q,{}),"data-test-id":y.moreBulkActionsButton})})]})]})}try{v.displayName="BulkActions",v.__docgenInfo={description:"",displayName:"BulkActions",props:{actions:{defaultValue:{value:"[]"},description:"Список массовых действий",name:"actions",required:!1,type:{name:"BulkAction[]"}},onCheck:{defaultValue:null,description:"Колбек смены значения чекбокса",name:"onCheck",required:!1,type:{name:"(() => void)"}},checked:{defaultValue:null,description:"Значение чекбокса",name:"checked",required:!1,type:{name:"boolean"}},indeterminate:{defaultValue:null,description:"Состояние частичного выбора",name:"indeterminate",required:!1,type:{name:"boolean"}},selectionMode:{defaultValue:{value:"multiple"},description:"Режим выбора",name:"selectionMode",required:!1,type:{name:"enum",value:[{value:'"single"'},{value:'"multiple"'}]}},resizingContainerRef:{defaultValue:null,description:"",name:"resizingContainerRef",required:!0,type:{name:"RefObject<HTMLDivElement>"}}}}}catch{}function V({open:e,onOpenChange:t,numberOfFilters:n}){const{t:u}=ue("Toolbar");return s.jsx(N,{tip:u(e?"hideFilters":"showFilters"),children:s.jsx(E,{size:"m",icon:s.jsx(R,{}),onClick:()=>t(!e),counter:n?{value:n,appearance:"neutral"}:void 0,"data-test-id":y.filterButton})})}try{V.displayName="FilterButton",V.__docgenInfo={description:"",displayName:"FilterButton",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"",name:"onOpenChange",required:!0,type:{name:"(open: boolean) => void"}},numberOfFilters:{defaultValue:null,description:"",name:"numberOfFilters",required:!1,type:{name:"number"}}}}}catch{}const ge="_separatorWrapper_1mbej_1",he="_separator_1mbej_1",W={separatorWrapper:ge,separator:he};function S(){return s.jsx("div",{className:W.separatorWrapper,children:s.jsx("div",{className:W.separator})})}function T({moreActions:e}){const[t,n]=p.useState(!1);return s.jsx(G,{trigger:"clickAndFocusVisible",open:t,"data-test-id":y.droplist,onOpenChange:n,placement:"bottom-end",scroll:!0,size:"s",items:e.map(u=>({onClick:r=>{var o;(o=u.onClick)==null||o.call(u,r),n(!1),r.stopPropagation()},disabled:u.disabled,content:u.content,beforeContent:u.icon,afterContent:u.tagLabel?s.jsx(ne,{label:u.tagLabel}):void 0,"data-test-id":y.option})),children:s.jsx(E,{icon:s.jsx(Q,{size:24}),size:"m","data-test-id":y.moreActionsButton})})}try{T.displayName="MoreActions",T.__docgenInfo={description:"",displayName:"MoreActions",props:{moreActions:{defaultValue:null,description:"",name:"moreActions",required:!0,type:{name:"Action[]"}}}}}catch{}function be({onCheck:e,checked:t,indeterminate:n,bulkActions:u=[],selectionMode:r}){return{onCheck:e,checked:t,indeterminate:n,actions:u,selectionMode:r}}function ye(e){return"selectionMode"in e&&e.selectionMode==="multiple"}const _e=";",Ae=/^\[.+]$/,De=/(\w+)\[([^\]]+)]([^;]+)?/g,$={filter:"filter",ordering:"ordering"},Ee={offset:"offset",limit:"limit"},Se=["in","ni"];var xe=function(e,t){var n={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&t.indexOf(u)<0&&(n[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,u=Object.getOwnPropertySymbols(e);r<u.length;r++)t.indexOf(u[r])<0&&Object.prototype.propertyIsEnumerable.call(e,u[r])&&(n[u[r]]=e[u[r]]);return n};const Be=/^[a-zA-Z\d]+:(,|[a-zA-Z\d]+).*/;function je(e){return Ae.test(e)}function P(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function z(e){const t=Number(e),n=["true","false"].includes(e)?e==="true":e;return isNaN(t)?n:t}function Fe(e){return e.length===0?"":`[${e.map(({field:n,direction:u})=>`${u}${n}`).join(",")}]`}function ke(e){return e.reduce((t,n,u)=>{const r=u!==0&&u!==e.length?_e:"",{field:o,condition:l,value:f}=n;let i=f;return Se.includes(l)&&Array.isArray(f)&&(i=`[${f.join(",")}]`),P(f)&&(i=Object.entries(f).reduce((c,[a,d],b,g)=>`${c}${a}:${d}${b===g.length-1?"":","}`,"")),`${t}${r}${o}[${l}]${i}`},"")}function x(e){return typeof e=="number"?!isNaN(e):typeof e=="string"||Array.isArray(e)?e.length!==0:P(e)?Object.keys(e).length!==0:e!=null}function Oe(e,{encode:t=!1}){var n,u;const{pagination:r}=e,o=xe(e,["pagination"]),l=Object.assign(Object.assign({},r),o);!((n=e.filter)===null||n===void 0)&&n.length&&(l.filter=ke(e.filter)),!((u=e.ordering)===null||u===void 0)&&u.length&&(l.ordering=Fe(e.ordering));const f=Object.entries(l).reduce((i,[c,a])=>{const d=i.length?"&":"";return`${i}${d}${c}=${a}`},"");return t?encodeURIComponent(f):f}function Ce(e){return Object.values(Ee).includes(e)}function C(e){if(e===void 0)return;if(je(e))try{return JSON.parse(e)}catch{return e.replace(/[[\]]/g,"").split(",").map(u=>u.trim())}if(Be.test(e)){const n=e.split(",").reduce((u,r)=>{const[o,l]=r.split(":");return o!==void 0&&l!==void 0&&(u[o]=z(l)),u},{});return Object.values(n).length?n:void 0}return z(e)}function J(e){return Object.keys(e).reduce((t,n)=>{const u=n;let r=e[u];return x(r)&&(P(r)&&(r=J(r)),Array.isArray(r)?(u==="filter"?r=r.filter(o=>x(o==null?void 0:o.value)):r=r.filter(x),r.length>0&&(t[u]=r)):t[u]=r),t},{})}function Ne(e){const t=e||{};function n(){return J(t)}function u({encode:r}={encode:!0}){return Oe(n(),{encode:r})}return e!==void 0?{toObject:n,toString:u}:{filter(r){return t.filter||(t.filter=[]),t.filter.push(r),this},ordering(r){return t.ordering||(t.ordering=[]),t.ordering.push(r),this},pagination(r){return t.pagination=r,this},search(r){return t.search=r,this},toObject:n,toString:u}}function ve(e){return e.length?decodeURIComponent(e).split("&").reduce((u,r)=>{const[o,l]=r.split("=");if(x(l)){if(o===$.ordering){const f=l.replace(/[[\]]/g,"").split(",");return f.length&&(u[o]=f.map(i=>{const c=i.startsWith("-")?"-":"+";return{field:i.replace(c,""),direction:c}})),u}if(o===$.filter){const f=Array.from(l.matchAll(De),([,i,c,a])=>[i,c,a]);return f.length&&(u[o]=f.map(([i,c,a])=>({field:i,condition:c,value:C(a)})).filter(({value:i})=>i!==void 0)),u}if(Ce(o))return u.pagination||(u.pagination={}),u.pagination[o]=C(l),u;u[o]=C(l)}return u},{}):void 0}const Ve=/[\d-:.TZ+]/g,Y=e=>typeof e!="string"||e.replaceAll(Ve,"").trim().length>0?!1:!isNaN(new Date(e).getTime()),j=e=>Y(e)?new Date(e):typeof e=="boolean"?String(e):e,Te=e=>{if(e)return Object.fromEntries(e.map(t=>Array.isArray(t.value)?[t.field,t.value.map(j)]:[t.field,j(t.value)]))},Pe=e=>{var n;const t=ve(e);return{pagination:t==null?void 0:t.pagination,ordering:t==null?void 0:t.ordering,search:((n=t==null?void 0:t.search)==null?void 0:n.toString())||"",filter:Te(t==null?void 0:t.filter)??{}}},qe=e=>Object.entries(e).reduce((t,[n,u])=>(Array.isArray(u)?t[n]=u.map(j):t[n]=j(u),t),{...e}),L=e=>e instanceof Date?e.toISOString():(Y(e),e),Ie=e=>{if(e)return Object.entries(e).filter(([,t])=>t!==void 0).map(([t,n])=>Array.isArray(n)?{value:n.map(L),condition:"in",field:t}:{value:L(n),condition:"eq",field:t})},Me=e=>Ne({pagination:e==null?void 0:e.pagination,search:(e==null?void 0:e.search)??"",ordering:e==null?void 0:e.ordering,filter:Ie(e==null?void 0:e.filter)}),We=e=>Me(e).toString();function $e({persist:e,filter:t,search:n}){const u=p.useRef(!1),r=p.useMemo(()=>{if(!(e!=null&&e.filterQueryKey)||!(e!=null&&e.id))return;const i=a=>{const d=(a==null?void 0:a.filter)===void 0||typeof a.filter=="object"&&a.filter!==null,b=(a==null?void 0:a.search)===void 0||typeof a.search=="string";return!!(d&&b)},c=a=>{const d=i(a);return e!=null&&e.validateData?d&&e.validateData(a):d};return{queryKey:e.filterQueryKey,localStorageKey:`${e.id}_filter`,validateData:c}},[e]),{getDefaultData:o,setDataToStorages:l}=ce({options:r,serializer:i=>e!=null&&e.serializer?e.serializer(i):We(i),parser:i=>e!=null&&e.parser?e.parser(i):Pe(i)}),f=p.useMemo(o,[o]);p.useEffect(()=>{var i;u.current||(f&&((i=e==null?void 0:e.onLoad)==null||i.call(e,{...f,filter:qe(f.filter??{})})),u.current=!0)},[f]),p.useEffect(()=>{if(!(e!=null&&e.id)||!(e!=null&&e.filterQueryKey)||!u.current)return;const i=e.state??o()??{};t&&(i.filter=t),n!==void 0&&(i.search=n),Object.keys(i).length!==0&&l(i)},[e==null?void 0:e.id,e==null?void 0:e.filterQueryKey,e==null?void 0:e.state,t,n,l,o])}const ze="_containerWrapper_itx2w_5",Le="_container_itx2w_5",Ke="_search_itx2w_34",Ue="_updateButton_itx2w_49",Qe="_beforeSearch_itx2w_61",Ge="_flexRow_itx2w_68",He="_actions_itx2w_77",Je="_list_itx2w_82",_={containerWrapper:ze,container:Le,search:Ke,updateButton:Ue,beforeSearch:Qe,flexRow:Ge,actions:He,list:Je};function Ye({filterRow:e}){const[t,n]=F(e==null?void 0:e.open,!1,c=>{var d;const a=typeof c=="function"?c(t):c;(d=e==null?void 0:e.onOpenChange)==null||d.call(e,a)}),[u,r]=F(e==null?void 0:e.value,(e==null?void 0:e.defaultValue)??{},c=>{var d;const a=typeof c=="function"?c(u):c;(d=e==null?void 0:e.onChange)==null||d.call(e,a)}),[o,l]=F(e==null?void 0:e.visibleFilters,Object.keys(u),c=>{var d;const a=typeof c=="function"?c(o):c;(d=e==null?void 0:e.onVisibleFiltersChange)==null||d.call(e,a)}),f=p.useMemo(()=>((e==null?void 0:e.filters)??[]).map(c=>["single","multiple"].includes(c.type)?{...c,dropDownClassName:U(c.dropDownClassName,_.list)}:c),[e==null?void 0:e.filters]),i=p.useMemo(()=>Object.keys(u).reduce((c,a)=>c+Number(Z(u[a])),0),[u]);return{filterButton:e?{open:t,onOpenChange:n,numberOfFilters:i}:void 0,filterRow:t&&e?{...e,open:void 0,onOpenChange:void 0,filters:f,value:u,onChange:r,visibleFilters:o,onVisibleFiltersChange:l}:void 0}}function K({className:e,after:t,outline:n,moreActions:u,onRefresh:r,search:o,filterRow:l,persist:f,...i}){const c=ye(i),a=!!(c||r),d=p.useRef(null),{filterButton:b,filterRow:g}=Ye({filterRow:l});return $e({persist:f,filter:g==null?void 0:g.value,search:o==null?void 0:o.value}),s.jsxs("div",{className:_.containerWrapper,...re(i),children:[s.jsxs("div",{className:U(_.container,e),"data-outline":n||void 0,ref:d,children:[a&&s.jsxs("div",{className:_.beforeSearch,children:[c&&s.jsxs(s.Fragment,{children:[s.jsx(v,{...be(i),resizingContainerRef:d}),s.jsx(S,{})]}),r&&s.jsxs(s.Fragment,{children:[s.jsx(E,{icon:s.jsx(te,{}),size:"m",className:_.updateButton,onClick:r,"data-test-id":y.refreshButton}),s.jsx(S,{})]})]}),o&&s.jsx(oe,{...o,className:_.search,size:"m","data-test-id":y.search}),(u||t||b)&&s.jsxs("div",{className:_.flexRow,"data-align-right":!o&&!a||void 0,children:[t&&s.jsxs(s.Fragment,{children:[(o||a)&&s.jsx(S,{}),s.jsx("div",{"data-test-id":y.after,className:_.actions,children:t})]}),(u||b)&&s.jsx(S,{}),b&&s.jsx(V,{...b}),u&&s.jsx(T,{moreActions:u})]})]}),g&&s.jsx(w,{...g,size:"xs","data-test-id":y.filterRow})]})}try{K.displayName="Toolbar",K.__docgenInfo={description:"",displayName:"Toolbar",props:{"data-test-id":{defaultValue:null,description:"",name:"data-test-id",required:!1,type:{name:"string"}},search:{defaultValue:null,description:`Параметры отвечают за строку поиска <br>
<strong>value</strong>: Значение строки поиска <br>
<strong>onChange</strong>: Колбэк смены значения <br>
<strong>onSubmit</strong>: Колбэк на подтверждение поиска по строке
<strong>placeholder</strong>: Плейсхолдер <br>
<strong>loading</strong>: Состояние загрузки <br>`,name:"search",required:!1,type:{name:"{ value: string; onChange(value: string): void; onSubmit?(value: string): void; placeholder?: string; loading?: boolean; } | undefined"}},className:{defaultValue:null,description:"Класснейм",name:"className",required:!1,type:{name:"string"}},outline:{defaultValue:null,description:"Внешний бордер",name:"outline",required:!1,type:{name:"boolean"}},selectionMode:{defaultValue:{value:"'multiple'"},description:"Режим выбора",name:"selectionMode",required:!1,type:{name:"enum",value:[{value:'"single"'},{value:'"multiple"'}]}},checked:{defaultValue:null,description:"Значение чекбокса",name:"checked",required:!1,type:{name:"boolean"}},onCheck:{defaultValue:null,description:"Колбек смены значения чекбокса",name:"onCheck",required:!1,type:{name:"(() => void)"}},indeterminate:{defaultValue:null,description:"Состояние частичного выбора",name:"indeterminate",required:!1,type:{name:"boolean"}},bulkActions:{defaultValue:null,description:"Список массовых действий",name:"bulkActions",required:!1,type:{name:"BulkAction[]"}},after:{defaultValue:null,description:"Дополнительный слот в конце тулбара",name:"after",required:!1,type:{name:"ReactNode"}},onRefresh:{defaultValue:null,description:"Колбек обновления",name:"onRefresh",required:!1,type:{name:"(() => void)"}},moreActions:{defaultValue:null,description:"Элементы выпадающего списка кнопки с действиями",name:"moreActions",required:!1,type:{name:"Action[]"}},filterRow:{defaultValue:null,description:"",name:"filterRow",required:!1,type:{name:"FilterRow<TState>"}},persist:{defaultValue:null,description:`Конфиг для сохранения состояния в localStorage и queryParams. <br>
Поле id должно быть уникальным для каждого инстанса компонента. <br>`,name:"persist",required:!1,type:{name:"ToolbarPersistConfig<TState>"}}}}}catch{}export{y as T,K as a};
