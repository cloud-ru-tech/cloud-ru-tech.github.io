import{j as i}from"./jsx-runtime-BTJTZTIL.js";import{c as L}from"./index-DUmpqB7p.js";import{r as p}from"./index-CJ_LmFaV.js";import{u as j}from"./index-JZGyZbA2.js";import{h as w,C as R}from"./ChipChoiceRow-CctBdq_j.js";import{i as S}from"./isBrowser-C2N6XvuH.js";import{u as F}from"./PopoverPrivate-C4IEYshr.js";import{u as k}from"./useIsomorphicLayoutEffect-BAXQmlEq.js";import{M as K,F as ee}from"./index-B2h5DBoi.js";import{C as te}from"./Checkbox-DHk-UVgp.js";import{T as C}from"./Tooltip-fOEkX7i0.js";import{B as E}from"./ButtonFunction-C3glRa3s.js";import{D as U}from"./DropList-kFL2cdbL.js";import{U as ue}from"./index-DbF-M2Rm.js";import{u as ne}from"./LocaleProvider-CyhbxqE1.js";import{T as re}from"./Tag-B2RrNZ7N.js";import{e as oe}from"./componentPropsProcessors-UJEZy8aQ.js";import{f as ae}from"./hooks-DLWaI-n_.js";function ie({parentContainerRef:e,resizingContainerRef:t=e,items:n,maxVisibleItems:u=1/0}){const r=m=>Math.min(u,m),[o,l]=p.useState(r(n.length)),[d,s]=p.useState(1/0),c=p.useRef(d),a=m=>{l(typeof m=="number"?r(m):h=>m(r(h)))},f=F(()=>{const m=e.current;m&&m.scrollWidth-m.offsetWidth>0&&n[o-1]&&a(A=>A-1)}),b=F(()=>{n[o]&&a(h=>h+1)}),g=F(({changedWidth:m,initialWidth:h})=>{m>h?o<u&&b():m<h&&f()});return p.useEffect(()=>{const m=()=>{f(),e.current&&s(e.current.scrollWidth)};return document.fonts.addEventListener("loadingdone",m),()=>document.fonts.removeEventListener("loadingdone",m)},[e,f]),p.useEffect(()=>{const m=t.current;if(m){const h=new ResizeObserver(A=>A.forEach(T=>{if(T.target===m){const[{inlineSize:Z}]=T.contentBoxSize;s(Math.floor(Z))}}));return h.observe(m),()=>h.disconnect()}},[t]),k(()=>{e.current&&g({initialWidth:e.current.scrollWidth,changedWidth:c.current})},[n,e,g]),k(()=>{g({initialWidth:c.current,changedWidth:d}),c.current=d},[d,g]),k(()=>{f()},[f,o]),{visibleItems:n.slice(0,o),hiddenItems:n.slice(o)}}class Q{constructor(t,n,u,r){this.filterKey=t,this.validate=n,this.parser=JSON.parse,this.serializer=JSON.stringify,this.getData=()=>{try{const o=this.getFromSource(),l=o?this.parser(o):null;return l&&this.validate(l)?l:null}catch{return null}},this.setData=o=>{const l=this.serializer(o);this.setToSource(l)},u&&(this.parser=u),r&&(this.serializer=r)}}class se extends Q{getFromSource(){return S()&&new URL(window.location.href).searchParams.get(this.filterKey)||""}setToSource(t){if(S()){const n=new URL(window.location.href);n.searchParams.set(this.filterKey,t),history.replaceState({},"",n)}}}class ce extends Q{getFromSource(){return S()&&localStorage.getItem(this.filterKey)||""}setToSource(t){S()&&localStorage.setItem(this.filterKey,t)}}const I=({source:e})=>{const t=p.useCallback(u=>{e&&e.setData(u)},[e]);return{getData:p.useCallback(()=>e==null?void 0:e.getData(),[e]),setData:t}},le=({options:e,parser:t,serializer:n})=>{const u=p.useMemo(()=>e?new se(e.queryKey,e.validateData,t,n):void 0,[e,t,n]),r=p.useMemo(()=>e?new ce(e.localStorageKey,e.validateData):void 0,[e]),{getData:o,setData:l}=I({source:u}),{getData:d,setData:s}=I({source:r}),c=p.useCallback(f=>{l(f),s(f)},[l,s]);return{getDefaultData:p.useCallback(()=>{const f=d();return f||o()},[o,d]),setDataToStorages:c}},y={checkbox:"toolbar__checkbox",confirmAction:"toolbar__confirm-action",rejectAction:"toolbar__reject-action",deleteAction:"toolbar__delete-action",deactivateAction:"toolbar__deactivate-action",disabledAction:"toolbar__disabled-action",bulkActions:"toolbar__bulk-actions",moreBulkActionsButton:"toolbar__more-bulk-actions-button",refreshButton:"toolbar__refresh-button",search:"toolbar__search",filterButton:"toolbar__filter-button",filterRow:"toolbar__filter-row",moreActionsButton:"toolbar__more-actions-button",droplist:"toolbar__droplist",option:"toolbar__droplist-option",after:"toolbar__after"},q={Multiple:"multiple"},de="_bulkActionsWrapper_18xkl_1",fe="_bulkActions_18xkl_1",me="_checkboxWrapper_18xkl_20",pe="_moreActionButton_18xkl_39",ge="_action_18xkl_43",D={bulkActionsWrapper:de,bulkActions:fe,checkboxWrapper:me,moreActionButton:pe,action:ge};function N({actions:e=[],checked:t,onCheck:n,indeterminate:u,selectionMode:r=q.Multiple,resizingContainerRef:o}){const l=p.useCallback(a=>{(a.key===" "||a.key==="Enter")&&(n==null||n())},[n]),d=p.useRef(null),{visibleItems:s,hiddenItems:c}=ie({items:e,resizingContainerRef:o,parentContainerRef:d,maxVisibleItems:3});return i.jsxs(i.Fragment,{children:[r===q.Multiple&&i.jsx("div",{className:D.checkboxWrapper,onClick:n,tabIndex:0,role:"checkbox","aria-checked":t,onKeyDown:l,"data-test-id":y.checkbox,children:i.jsx(te,{size:"s",checked:t,indeterminate:u,tabIndex:-1})}),(t||u)&&e.length>0&&i.jsxs("div",{className:D.bulkActionsWrapper,"data-test-id":y.bulkActions,ref:d,children:[i.jsx("div",{className:D.bulkActions,children:s.map(({label:a,icon:f,onClick:b,disabled:g,tooltip:m,"data-test-id":h})=>i.jsx(C,{tip:m,open:m?void 0:!1,placement:"top","data-test-id":`${h}-tooltip`,children:i.jsx(E,{className:D.action,fullWidth:!0,"data-test-id":h,iconPosition:"before",icon:i.jsx(f,{}),label:a,size:"m",onClick:b,disabled:g})},a))}),c.length>0&&i.jsx(U,{trigger:"clickAndFocusVisible",closeDroplistOnItemClick:!0,items:c.map(({label:a,icon:f,onClick:b,disabled:g,tooltip:m,"data-test-id":h})=>({id:a,content:{option:a},beforeContent:i.jsx(f,{}),onClick:b,disabled:g,itemWrapRender:A=>i.jsx(C,{tip:m,open:m?void 0:!1,placement:"right","data-test-id":`${h}-tooltip`,children:A}),"data-test-id":h})),children:i.jsx(E,{className:D.moreActionButton,size:"m",icon:i.jsx(K,{}),"data-test-id":y.moreBulkActionsButton})})]})]})}try{N.displayName="BulkActions",N.__docgenInfo={description:"",displayName:"BulkActions",props:{actions:{defaultValue:{value:"[]"},description:"Список массовых действий",name:"actions",required:!1,type:{name:"BulkAction[]"}},onCheck:{defaultValue:null,description:"Колбек смены значения чекбокса",name:"onCheck",required:!1,type:{name:"(() => void)"}},checked:{defaultValue:null,description:"Значение чекбокса",name:"checked",required:!1,type:{name:"boolean"}},indeterminate:{defaultValue:null,description:"Состояние частичного выбора",name:"indeterminate",required:!1,type:{name:"boolean"}},selectionMode:{defaultValue:{value:"multiple"},description:"Режим выбора",name:"selectionMode",required:!1,type:{name:"enum",value:[{value:'"single"'},{value:'"multiple"'}]}},resizingContainerRef:{defaultValue:null,description:"",name:"resizingContainerRef",required:!0,type:{name:"RefObject<HTMLDivElement>"}}}}}catch{}function v({open:e,onOpenChange:t,numberOfFilters:n}){const{t:u}=ne("Toolbar");return i.jsx(C,{tip:u(e?"hideFilters":"showFilters"),children:i.jsx(E,{size:"m",icon:i.jsx(ee,{}),onClick:()=>t(!e),counter:n?{value:n,appearance:"neutral"}:void 0,"data-test-id":y.filterButton})})}try{v.displayName="FilterButton",v.__docgenInfo={description:"",displayName:"FilterButton",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"",name:"onOpenChange",required:!0,type:{name:"(open: boolean) => void"}},numberOfFilters:{defaultValue:null,description:"",name:"numberOfFilters",required:!1,type:{name:"number"}}}}}catch{}const he="_separatorWrapper_1mbej_1",be="_separator_1mbej_1",P={separatorWrapper:he,separator:be};function x(){return i.jsx("div",{className:P.separatorWrapper,children:i.jsx("div",{className:P.separator})})}function V({moreActions:e}){const[t,n]=p.useState(!1);return i.jsx(U,{trigger:"clickAndFocusVisible",open:t,"data-test-id":y.droplist,onOpenChange:n,placement:"bottom-end",scroll:!0,size:"s",items:e.map(u=>({onClick:r=>{var o;(o=u.onClick)==null||o.call(u,r),n(!1),r.stopPropagation()},disabled:u.disabled,content:u.content,beforeContent:u.icon,afterContent:u.tagLabel?i.jsx(re,{label:u.tagLabel}):void 0,"data-test-id":y.option})),children:i.jsx(E,{icon:i.jsx(K,{size:24}),size:"m","data-test-id":y.moreActionsButton})})}try{V.displayName="MoreActions",V.__docgenInfo={description:"",displayName:"MoreActions",props:{moreActions:{defaultValue:null,description:"",name:"moreActions",required:!0,type:{name:"Action[]"}}}}}catch{}function ye({onCheck:e,checked:t,indeterminate:n,bulkActions:u=[],selectionMode:r}){return{onCheck:e,checked:t,indeterminate:n,actions:u,selectionMode:r}}function _e(e){return"selectionMode"in e&&e.selectionMode==="multiple"}const G=";",Ae=/^\[.+]$/,De=/(\w+)\[([^\]]+)]([^;]+)?/g,M={filter:"filter",sort:"sort"},Ee={offset:"offset",limit:"limit"},xe=["in","ni"];var Se=function(e,t){var n={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&t.indexOf(u)<0&&(n[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,u=Object.getOwnPropertySymbols(e);r<u.length;r++)t.indexOf(u[r])<0&&Object.prototype.propertyIsEnumerable.call(e,u[r])&&(n[u[r]]=e[u[r]]);return n};const Be=/^[a-zA-Z\d]+:(,|[a-zA-Z\d]+).*/;function je(e){return Ae.test(e)}function H(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function W(e){const t=Number(e),n=["true","false"].includes(e)?e==="true":e;return isNaN(t)?n:t}function Fe(e){return e.reduce((t,n,u)=>{const r=u!==0&&u!==e.length?G:"",{field:o,direction:l}=n;return`${t}${r}${o}[${l}]`},"")}function ke(e){return e.reduce((t,n,u)=>{const r=u!==0&&u!==e.length?G:"",{field:o,condition:l,value:d}=n;let s=d;return xe.includes(l)&&Array.isArray(d)&&(s=`[${d.join(",")}]`),H(d)&&(s=Object.entries(d).reduce((c,[a,f],b,g)=>`${c}${a}:${f}${b===g.length-1?"":","}`,"")),`${t}${r}${o}[${l}]${s}`},"")}function J(e){return typeof e=="number"?!isNaN(e):typeof e=="string"||Array.isArray(e)?e.length!==0:e!==void 0}function Oe(e){var t,n;const{pagination:u}=e,r=Se(e,["pagination"]),o=Object.assign(Object.assign({},u),r);!((t=e.filter)===null||t===void 0)&&t.length&&(o.filter=ke(e.filter)),!((n=e.sort)===null||n===void 0)&&n.length&&(o.sort=Fe(e.sort));const l=Object.entries(o).reduce((d,[s,c])=>{const a=d.length?"&":"";return`${d}${a}${s}=${c}`},"");return encodeURIComponent(l)}function Ce(e){return Object.values(Ee).includes(e)}function O(e){if(e===void 0)return;if(je(e))try{return JSON.parse(e)}catch{return e.replace(/[[\]]/g,"").split(",").map(u=>u.trim())}if(Be.test(e)){const n=e.split(",").reduce((u,r)=>{const[o,l]=r.split(":");return o!==void 0&&l!==void 0&&(u[o]=W(l)),u},{});return Object.values(n).length?n:void 0}return W(e)}function Y(e){return Object.keys(e).reduce((t,n)=>{const u=n;let r=e[u];return J(r)&&(H(r)&&(r=Y(r)),t[u]=r),t},{})}function Ne(e){const t=e||{};function n(){return Y(t)}function u(){return Oe(n())}return e!==void 0?{toObject:n,toString:u}:{filter(r){return t.filter||(t.filter=[]),t.filter.push(r),this},sort(r){return t.sort||(t.sort=[]),t.sort.push(r),this},pagination(r){return t.pagination=r,this},search(r){return t.search=r,this},toObject:n,toString:u}}function ve(e){return e.length?decodeURIComponent(e).split("&").reduce((u,r)=>{const[o,l]=r.split("=");if(J(l)){const d=Array.from(l.matchAll(De),([,s,c,a])=>[s,c,a]);if(o===M.sort)return d.length&&(u[o]=d.map(([s,c])=>({field:s,direction:c}))),u;if(o===M.filter)return d.length&&(u[o]=d.map(([s,c,a])=>({field:s,condition:c,value:O(a)})).filter(({value:s})=>s!==void 0)),u;if(Ce(o))return u.pagination||(u.pagination={}),u.pagination[o]=O(l),u;u[o]=O(l)}return u},{}):void 0}const X=e=>typeof e=="string"&&!isNaN(Number(new Date(e))),B=e=>X(e)?new Date(e):typeof e=="boolean"?String(e):e,Ve=e=>{if(e)return Object.fromEntries(e.map(t=>Array.isArray(t.value)?[t.field,t.value.map(B)]:[t.field,B(t.value)]))},Te=e=>{var n;const t=ve(e);return{pagination:t==null?void 0:t.pagination,sorting:t==null?void 0:t.sort,search:((n=t==null?void 0:t.search)==null?void 0:n.toString())||"",filter:Ve(t==null?void 0:t.filter)??{}}},Ie=e=>Object.entries(e).reduce((t,[n,u])=>(Array.isArray(u)?t[n]=u.map(B):t[n]=B(u),t),{...e}),$=e=>e instanceof Date?e.toISOString():(X(e),e),qe=e=>{if(e)return Object.entries(e).filter(([,t])=>t!==void 0).map(([t,n])=>Array.isArray(n)?{value:n.map($),condition:"in",field:t}:{value:$(n),condition:"eq",field:t})},Pe=e=>Ne({pagination:e==null?void 0:e.pagination,search:(e==null?void 0:e.search)??"",sort:e==null?void 0:e.sorting,filter:qe(e==null?void 0:e.filter)}).toString();function Me({persist:e,filter:t,search:n}){const u=p.useRef(!1),r=p.useMemo(()=>{if(!(e!=null&&e.filterQueryKey)||!(e!=null&&e.id))return;const s=a=>{const f=(a==null?void 0:a.filter)===void 0||typeof a.filter=="object"&&a.filter!==null,b=(a==null?void 0:a.search)===void 0||typeof a.search=="string";return!!(f&&b)},c=a=>{const f=s(a);return e!=null&&e.validateData?f&&e.validateData(a):f};return{queryKey:e.filterQueryKey,localStorageKey:`${e.id}_filter`,validateData:c}},[e]),{getDefaultData:o,setDataToStorages:l}=le({options:r,serializer:s=>e!=null&&e.serializer?e.serializer(s):Pe(s),parser:s=>e!=null&&e.parser?e.parser(s):Te(s)}),d=p.useMemo(o,[o]);p.useEffect(()=>{var s;u.current||(d&&((s=e==null?void 0:e.onLoad)==null||s.call(e,{...d,filter:Ie(d.filter??{})})),u.current=!0)},[d]),p.useEffect(()=>{if(!(e!=null&&e.id)||!(e!=null&&e.filterQueryKey)||!u.current)return;const s=e.state??o()??{};t&&(s.filter=t),n!==void 0&&(s.search=n),Object.keys(s).length!==0&&l(s)},[e==null?void 0:e.id,e==null?void 0:e.filterQueryKey,e==null?void 0:e.state,t,n,l,o])}const We="_containerWrapper_itx2w_5",$e="_container_itx2w_5",ze="_search_itx2w_34",Le="_updateButton_itx2w_49",Ke="_beforeSearch_itx2w_61",Ue="_flexRow_itx2w_68",Qe="_actions_itx2w_77",Ge="_list_itx2w_82",_={containerWrapper:We,container:$e,search:ze,updateButton:Le,beforeSearch:Ke,flexRow:Ue,actions:Qe,list:Ge};function He({filterRow:e}){const[t,n]=j(e==null?void 0:e.open,!1,c=>{var f;const a=typeof c=="function"?c(t):c;(f=e==null?void 0:e.onOpenChange)==null||f.call(e,a)}),[u,r]=j(e==null?void 0:e.value,(e==null?void 0:e.defaultValue)??{},c=>{var f;const a=typeof c=="function"?c(u):c;(f=e==null?void 0:e.onChange)==null||f.call(e,a)}),[o,l]=j(e==null?void 0:e.visibleFilters,Object.keys(u),c=>{var f;const a=typeof c=="function"?c(o):c;(f=e==null?void 0:e.onVisibleFiltersChange)==null||f.call(e,a)}),d=p.useMemo(()=>((e==null?void 0:e.filters)??[]).map(c=>["single","multiple"].includes(c.type)?{...c,dropDownClassName:L(c.dropDownClassName,_.list)}:c),[e==null?void 0:e.filters]),s=p.useMemo(()=>Object.keys(u).reduce((c,a)=>c+Number(w(u[a])),0),[u]);return{filterButton:e?{open:t,onOpenChange:n,numberOfFilters:s}:void 0,filterRow:t&&e?{...e,open:void 0,onOpenChange:void 0,filters:d,value:u,onChange:r,visibleFilters:o,onVisibleFiltersChange:l}:void 0}}function z({className:e,after:t,outline:n,moreActions:u,onRefresh:r,search:o,filterRow:l,persist:d,...s}){const c=_e(s),a=!!(c||r),f=p.useRef(null),{filterButton:b,filterRow:g}=He({filterRow:l});return Me({persist:d,filter:g==null?void 0:g.value,search:o==null?void 0:o.value}),i.jsxs("div",{className:_.containerWrapper,...oe(s),children:[i.jsxs("div",{className:L(_.container,e),"data-outline":n||void 0,ref:f,children:[a&&i.jsxs("div",{className:_.beforeSearch,children:[c&&i.jsxs(i.Fragment,{children:[i.jsx(N,{...ye(s),resizingContainerRef:f}),i.jsx(x,{})]}),r&&i.jsxs(i.Fragment,{children:[i.jsx(E,{icon:i.jsx(ue,{}),size:"m",className:_.updateButton,onClick:r,"data-test-id":y.refreshButton}),i.jsx(x,{})]})]}),o&&i.jsx(ae,{...o,className:_.search,size:"m","data-test-id":y.search}),(u||t||b)&&i.jsxs("div",{className:_.flexRow,"data-align-right":!o&&!a||void 0,children:[t&&i.jsxs(i.Fragment,{children:[(o||a)&&i.jsx(x,{}),i.jsx("div",{"data-test-id":y.after,className:_.actions,children:t})]}),(u||b)&&i.jsx(x,{}),b&&i.jsx(v,{...b}),u&&i.jsx(V,{moreActions:u})]})]}),g&&i.jsx(R,{...g,size:"xs","data-test-id":y.filterRow})]})}try{z.displayName="Toolbar",z.__docgenInfo={description:"",displayName:"Toolbar",props:{"data-test-id":{defaultValue:null,description:"",name:"data-test-id",required:!1,type:{name:"string"}},search:{defaultValue:null,description:`Параметры отвечают за строку поиска <br>
<strong>value</strong>: Значение строки поиска <br>
<strong>onChange</strong>: Колбэк смены значения <br>
<strong>onSubmit</strong>: Колбэк на подтверждение поиска по строке
<strong>placeholder</strong>: Плейсхолдер <br>
<strong>loading</strong>: Состояние загрузки <br>`,name:"search",required:!1,type:{name:"{ value: string; onChange(value: string): void; onSubmit?(value: string): void; placeholder?: string; loading?: boolean; } | undefined"}},className:{defaultValue:null,description:"Класснейм",name:"className",required:!1,type:{name:"string"}},outline:{defaultValue:null,description:"Внешний бордер",name:"outline",required:!1,type:{name:"boolean"}},checked:{defaultValue:null,description:"Значение чекбокса",name:"checked",required:!1,type:{name:"boolean"}},selectionMode:{defaultValue:{value:"'multiple'"},description:"Режим выбора",name:"selectionMode",required:!1,type:{name:"enum",value:[{value:'"single"'},{value:'"multiple"'}]}},onCheck:{defaultValue:null,description:"Колбек смены значения чекбокса",name:"onCheck",required:!1,type:{name:"(() => void)"}},indeterminate:{defaultValue:null,description:"Состояние частичного выбора",name:"indeterminate",required:!1,type:{name:"boolean"}},bulkActions:{defaultValue:null,description:"Список массовых действий",name:"bulkActions",required:!1,type:{name:"BulkAction[]"}},after:{defaultValue:null,description:"Дополнительный слот в конце тулбара",name:"after",required:!1,type:{name:"ReactNode"}},onRefresh:{defaultValue:null,description:"Колбек обновления",name:"onRefresh",required:!1,type:{name:"(() => void)"}},moreActions:{defaultValue:null,description:"Элементы выпадающего списка кнопки с действиями",name:"moreActions",required:!1,type:{name:"Action[]"}},filterRow:{defaultValue:null,description:"",name:"filterRow",required:!1,type:{name:"FilterRow<TState>"}},persist:{defaultValue:null,description:`Конфиг для сохранения состояния в localStorage и queryParams. <br>
Поле id должно быть уникальным для каждого инстанса компонента. <br>`,name:"persist",required:!1,type:{name:"ToolbarPersistConfig<TState>"}}}}}catch{}export{y as T,z as a};
